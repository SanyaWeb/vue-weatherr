(function(e){function t(t){for(var i,s,c=t[0],o=t[1],u=t[2],d=0,f=[];d<c.length;d++)s=c[d],Object.prototype.hasOwnProperty.call(r,s)&&r[s]&&f.push(r[s][0]),r[s]=0;for(i in o)Object.prototype.hasOwnProperty.call(o,i)&&(e[i]=o[i]);l&&l(t);while(f.length)f.shift()();return a.push.apply(a,u||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],i=!0,c=1;c<n.length;c++){var o=n[c];0!==r[o]&&(i=!1)}i&&(a.splice(t--,1),e=s(s.s=n[0]))}return e}var i={},r={app:0},a=[];function s(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=i,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(n,i,function(t){return e[t]}.bind(null,i));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],o=c.push.bind(c);c.push=t,c=c.slice();for(var u=0;u<c.length;u++)t(c[u]);var l=o;a.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"034f":function(e,t,n){"use strict";var i=n("85ec"),r=n.n(i);r.a},"13f1":function(e,t,n){"use strict";var i=n("7029"),r=n.n(i);r.a},"26e0":function(e,t,n){},"27db":function(e,t,n){"use strict";var i=n("26e0"),r=n.n(i);r.a},3421:function(e,t,n){"use strict";var i=n("5e3b"),r=n.n(i);r.a},"52ea":function(e,t,n){},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var i=n("2b0e"),r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"weather"}},[n("div",{staticClass:"weather-header-wrap"},[n("weatherHeader")],1),n("cityList"),n("weatherResult")],1)},a=[],s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"weather-header"},[e._v(" Погода: "),e.activeCity.id?n("span",[e._v(" г. "+e._s(e.activeCity.name)+" ")]):n("span",[e._v(" выберите город ")])])},c=[],o={name:"weatherHeader",computed:{activeCity:function(){return this.$store.getters.activeCity}}},u=o,l=(n("3421"),n("2877")),d=Object(l["a"])(u,s,c,!1,null,null,null),f=d.exports,h=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"city-list"},[n("div",{staticClass:"city-list__header",on:{click:e.toggleList}},[n("span",{staticClass:"city-list__header-name"},[e._v("Выбрать/изменить город")]),n("span",{staticClass:"city-list__header-icon"})]),n("div",{staticClass:"city-list__select",class:{"city-list__select_open":e.showList}},[n("form",{staticClass:"city-list__add",on:{submit:function(t){return t.preventDefault(),e.addCity(t)}}},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.newCity,expression:"newCity"}],staticClass:"city-list__add-input",attrs:{type:"text",placeholder:"Добавить город"},domProps:{value:e.newCity},on:{input:function(t){t.target.composing||(e.newCity=t.target.value)}}}),n("button",{staticClass:"city-list__add-button"},[e._v("+")]),e.cityError?n("span",{staticClass:"info info_error"},[e._v(e._s(e.cityErrorText))]):e._e()]),n("div",{staticClass:"city-list__options"},e._l(e.cities,(function(t){return n("div",{key:t.id,staticClass:"city-list__option",class:{"city-list__option_active":t.active}},[n("label",{staticClass:"city-list__option-label"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.activeCityId,expression:"activeCityId"}],attrs:{hidden:"",type:"radio",name:"city"},domProps:{value:t.id,checked:e._q(e.activeCityId,t.id)},on:{change:[function(n){e.activeCityId=t.id},e.changeCity]}}),n("span",{staticClass:"city-list__city-name"},[e._v(e._s(t.name))])]),n("span",{staticClass:"city-list__option-close",attrs:{"data-city-id":t.id},on:{click:e.deleteCity}},[e._v("×")])])})),0)])])},v=[],p=(n("d3b7"),n("96cf"),{name:"cityList",data:function(){return{showList:!1,activeCityId:0,newCity:"",cityError:!1,cityErrorText:""}},computed:{cities:function(){return this.$store.getters.cities},weatherResponseStatus:function(){return this.$store.getters.responseStatus}},mounted:function(){return regeneratorRuntime.async((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(this.$store.dispatch("getUserCities",{cities:this.$store.getters.cities}));case 2:this.activeCityId=this.$store.getters.activeCity.id;case 3:case"end":return e.stop()}}),null,this)},methods:{toggleList:function(){this.cityError=!1,this.cityErrorText="",this.showList=!this.showList},deleteCity:function(e){var t=e.target.dataset.cityId;this.$store.dispatch("deleteCity",{cityId:t})},changeCity:function(e){this.toggleList(),this.cityError=!1,this.cityErrorText="",e.target.checked&&this.$store.dispatch("changeCity",{activeCityId:this.activeCityId})},addCity:function(){return regeneratorRuntime.async((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(this.$store.dispatch("addCity",{cityName:this.newCity}));case 2:this.activeCityId=this.$store.getters.activeCity.id,200===this.weatherResponseStatus?(this.showList=!this.showList,this.newCity=""):(this.cityError=!0,this.cityErrorText="Город не найден");case 4:case"end":return e.stop()}}),null,this)}}}),y=p,w=(n("13f1"),Object(l["a"])(y,h,v,!1,null,null,null)),b=w.exports,m=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"weather-result"},[e.preloader?n("preloader"):n("div",[n("div",{staticClass:"weather-result__head"},[e._v(e._s(e.cityName)+": "+e._s(e.weatherInfo.main.temp)+" C° "+e._s(e.weatherInfo.weather[0].main))]),n("div",{staticClass:"weather-result__info"},[n("div",{staticClass:"weather-result__attrs"},[n("div",{staticClass:"weather-result__attr"},[e._v("Ветер: ")]),n("div",{staticClass:"weather-result__attr"},[e._v("Влажность: ")]),n("div",{staticClass:"weather-result__attr"},[e._v("Давление: ")])]),n("div",{staticClass:"weather-result__values"},[n("div",{staticClass:"weather-result__value"},[e._v(e._s(e.weatherInfo.wind.speed)+" м/с")]),n("div",{staticClass:"weather-result__value"},[e._v(e._s(e.weatherInfo.main.humidity)+" %")]),n("div",{staticClass:"weather-result__value"},[e._v(e._s(parseInt(.75*e.weatherInfo.main.pressure))+" мм. рт. ст")])])])])],1)},C=[],g=(n("b0c0"),function(){var e=this,t=e.$createElement;e._self._c;return e._m(0)}),_=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"preloader"},[n("section",[n("div",{staticClass:"sk-cube-grid"},[n("div",{staticClass:"sk-cube sk-cube-1"}),n("div",{staticClass:"sk-cube sk-cube-2"}),n("div",{staticClass:"sk-cube sk-cube-3"}),n("div",{staticClass:"sk-cube sk-cube-4"}),n("div",{staticClass:"sk-cube sk-cube-5"}),n("div",{staticClass:"sk-cube sk-cube-6"}),n("div",{staticClass:"sk-cube sk-cube-7"}),n("div",{staticClass:"sk-cube sk-cube-8"}),n("div",{staticClass:"sk-cube sk-cube-9"})])])])}],x=(n("27db"),{}),k=Object(l["a"])(x,g,_,!1,null,"07e34a72",null),j=k.exports,O={name:"weatherResult",computed:{preloader:function(){return!this.$store.getters.showWeather},cityName:function(){return this.$store.getters.activeCity.name},weatherInfo:function(){return this.$store.getters.weatherInfo}},components:{preloader:j}},I=O,S=(n("b455"),Object(l["a"])(I,m,C,!1,null,"1fbfb9a1",null)),E=S.exports,P={name:"weather",components:{weatherHeader:f,cityList:b,weatherResult:E}},R=P,W=(n("034f"),Object(l["a"])(R,r,a,!1,null,null,null)),L=W.exports,$=n("2f62"),N=(n("a4d3"),n("99af"),n("4de4"),n("4160"),n("26e9"),n("fb6a"),n("e439"),n("dbb4"),n("b64b"),n("e25e"),n("159b"),n("2fa7")),T=n("bf2d"),D=n("9f12"),A=n("53fe"),B=function(){function e(){Object(D["a"])(this,e),this.default={idbObject:null,idbtran:null,dbRequest:null,db:null,version:1,tables:null}}return Object(A["a"])(e,[{key:"init",value:function(e){var t=this;if("indexedDB"in window)return new Promise((function(n,i){t.default.idbObject=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,t.default.idbtran=window.IDBTransaction||window.webkitIDBTransaction,t.default.tables=e.tables;var r=t.default,a=window.indexedDB.open(e.database,e.version);a.onerror=function(){console.log("Error opening database."),i()},a.onsuccess=function(t){r.db=this.result,r.version=e.version,n()},a.onupgradeneeded=function(e){var t=e.target.result;r.db=t;for(var i=r.tables,a=0;a<t.objectStoreNames.length;a++){for(var s=!0,c=0;c<i.length;c++)if(t.objectStoreNames[a]===i[c].name){s=!1;break}s&&r.db.deleteObjectStore(t.objectStoreNames[a])}for(var o=0;o<i.length;o++)if(!t.objectStoreNames.contains(i[o].name)){var u=t.createObjectStore(i[o].name,{keyPath:i[o].keyPath,autoIncrement:i[o].autoIncrement});if(console.log(i[o].name+" Created."),null!=i[o].index&&"undefined"!==i[o].index)for(var l=0;l<i[o].index.length;l++)u.createIndex(i[o].index[l].name,i[o].index[l].name,{unique:i[o].index[l].unique})}n()}}));console.log("This browser doesn't support IndexedDB")}},{key:"tableExist",value:function(e){for(var t=this.default.tables,n=!1,i=0;i<t.length;i++)if(t[i].name===e){n=!0;break}return n}},{key:"insert",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this.tableExist(e)){var i=this.default.db,r=i.transaction(e,"readwrite"),a=r.objectStore(e),s=1;if(t.constructor===Array){s=t.length;for(var c=0;c<s;c++)a.put(t[c])}else a.put(t);r.oncomplete=function(){n&&"function"===typeof n&&n(!0,s+" records inserted.")}}else n&&"function"===typeof n&&n(!1,e+" Table not found.")}},{key:"delete",value:function(e,t,n){var i=this;return new Promise((function(r,a){if(i.tableExist(e)){var s=i.default.db,c=s.transaction(e,"readwrite"),o=c.objectStore(e),u=-1;if(t&&"function"===typeof t)o.clear();else if(t.constructor===Array){u=t.length;for(var l=0;l<u;l++)o.delete(t[l])}else u=1,o.delete(t);c.oncomplete=function(e){n&&"function"===typeof n&&n(!0,""+u===-1?"All":u+" records deleted."),t&&"function"===typeof t&&t(!0,(-1===u?"All":u)+" records deleted."),r()},c.onerror=function(){n&&"function"===typeof n&&n(!1,c.error),a()}}else n&&"function"===typeof n&&n(!1,e+" Table not found.")}))}},{key:"select",value:function(e,t,n){var i=this;return new Promise((function(r,a){if(i.tableExist(e)){var s,c=i.default.db,o=c.transaction([e],"readonly"),u=o.objectStore(e),l=-1;if(t&&"function"===typeof t)s=u.getAll();else if(t.constructor===Array)l=t.length,s=u.getAll();else if(t&&"object"===Object(T["a"])(t)&&t.constructor===Object){l=1;var d=u.index(t.key);s=d.getAll(t.value)}else l=1,s=u.get(t);o.oncomplete=function(e){var i=s.result,a=s.source.keyPath,c=[];if(l>1){for(var o=0;o<i.length;o++)for(var u=0;u<l;u++)if(i[o][a]===t[u]){c.push(i[o]);break}i=c}n&&"function"===typeof n&&n(!0,i),t&&"function"===typeof t&&t(!0,s.result),r()},o.onerror=function(){n&&"function"===typeof n&&n(!1,s.error),a()}}else n&&"function"===typeof n&&n(!1,e+" Table not found.")}))}}]),e}(),q=B;function U(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function M(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?U(n,!0).forEach((function(t){Object(N["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):U(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var H=new q,J={database:"Weather",version:1,tables:[{name:"CitiesList",keyPath:"id",autoIncrement:!0,index:[{name:"name",unique:!1}]}]},z=[{id:1,name:"Барнаул",active:!1},{id:2,name:"Москва",active:!1}],F={state:{activeCity:{id:0,name:""},cities:[].concat(z)},getters:{cities:function(e){return e.cities},activeCity:function(e){return e.activeCity}},mutations:{changeCity:function(e,t){e.cities.forEach((function(n){t===n.id?(n.active=!0,e.activeCity=n):n.active=!1}))},activeCity:function(e,t){e.activeCity=t},setCities:function(e,t){e.cities=t,e.cities.forEach((function(t){t.active&&(e.activeCity=t)}))}},actions:{changeCity:function(e,t){var n,i,r,a,s;return regeneratorRuntime.async((function(c){while(1)switch(c.prev=c.next){case 0:return n=e.dispatch,i=e.commit,r=e.state,a=M({},r.activeCity),a.active=!1,i("changeCity",t.activeCityId),s=a.id?[a,r.activeCity]:[r.activeCity],c.next=7,regeneratorRuntime.awrap(H.insert("CitiesList",s,!1));case 7:return c.next=9,regeneratorRuntime.awrap(n("getWeather",{cityName:r.activeCity.name}));case 9:case"end":return c.stop()}}))},addCity:function(e,t){var n,i,r,a,s,c,o,u,l,d;return regeneratorRuntime.async((function(f){while(1)switch(f.prev=f.next){case 0:if(n=e.dispatch,i=e.commit,r=e.getters,a=e.state,s=!1,c=t.cityName.toLowerCase(),c=t.cityName[0].toUpperCase()+t.cityName.slice(1),"string"!==typeof t.cityName||!t.cityName.length){f.next=13;break}if(o=a.cities.filter((function(e){return e.name===c})),o.length){f.next=12;break}return f.next=9,regeneratorRuntime.awrap(n("getWeather",{cityName:c}));case 9:200===r.responseStatus?s=!0:i("showWeather",!0),f.next=13;break;case 12:n("changeCity",{activeCityId:o[0].id});case 13:if(!s){f.next=22;break}return u={name:c,active:!0},l=M({},a.activeCity),l.active=!1,d=l.id?[l,u]:[u],f.next=20,regeneratorRuntime.awrap(H.insert("CitiesList",d,!1));case 20:return f.next=22,regeneratorRuntime.awrap(H.select("CitiesList",(function(e,t){e?i("setCities",t.reverse()):console.log("error select")})));case 22:case"end":return f.stop()}}))},deleteCity:function(e,t){var n,i,r,a;return regeneratorRuntime.async((function(s){while(1)switch(s.prev=s.next){case 0:return n=e.dispatch,i=e.commit,r=e.state,a=parseInt(t.cityId),s.next=4,regeneratorRuntime.awrap(H.delete("CitiesList",a,(function(e,t){e?a===r.activeCity.id&&(i("setWeather",null),i("showWeather",!1),i("activeCity",{id:0,name:""})):console.log("error delete")})));case 4:n("getUserCities",{cities:[].concat(z)});case 5:case"end":return s.stop()}}))},getUserCities:function(e,t){var n,i,r,a,s;return regeneratorRuntime.async((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.dispatch,i=e.commit,r=e.getters,a=e.state,t.next=3,regeneratorRuntime.awrap(H.init(J));case 3:return s=[],t.next=6,regeneratorRuntime.awrap(H.select("CitiesList",(function(e,t){e?s=t.reverse():console.log("error select")})));case 6:s.length?(i("setCities",s),a.activeCity.name&&!r.showWeather&&n("getWeather",{cityName:a.activeCity.name})):(i("setWeather",null),i("showWeather",!1),i("activeCity",{id:0,name:""}),H.insert("CitiesList",z,(function(e,t){i("setCities",z),e||console.log("Error: ",t)})));case 7:case"end":return t.stop()}}))}}},G=function(e){var t={method:"GET",headers:{Accept:"application/json"}},n="https://openweathermap.org/data/2.5/weather/?appid=b6907d289e10d714a6e88b30761fae22&q="+e+"&units=metric";return fetch(n,t)},Z=function(e){return new Promise((function(t,n){var i={method:"POST",headers:{"Content-type":"application/x-www-form-urlencoded; charset=UTF-8"},body:"key=trnsl.1.1.20150220T075029Z.9cf93bf0c577ba4e.fd759dcc8e44209dc60e5046affe74f9db4bde05"};i.body+="&text=sky "+e+"&lang=en-ru",fetch("https://translate.yandex.net/api/v1.5/tr.json/translate",i).then((function(n){200===n.status?n.json().then((function(e){t(e.text[0].substring(5))})):t(e)}))}))},K={state:{weather:null,showWeather:!1,responseStatus:500},getters:{weatherInfo:function(e){return e.weather},showWeather:function(e){return e.showWeather},responseStatus:function(e){return e.responseStatus}},mutations:{setWeather:function(e,t){e.weather=t},showWeather:function(e,t){e.showWeather=t},responseStatus:function(e,t){e.responseStatus=t}},actions:{getWeather:function(e,t){var n,i;return regeneratorRuntime.async((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.commit,i=t.cityName,n("showWeather",!1),r.prev=3,r.next=6,regeneratorRuntime.awrap(G(i).then((function(e){n("responseStatus",e.status),200!==e.status?console.log("Сервис погоды https://openweathermap.org/ не нашел такого города"+i):e.json().then((function(e){var t=e.weather[0].main;Z(t).then((function(t){e.weather[0].main=t,n("setWeather",e),n("showWeather",!0)}))}))})));case 6:r.next=11;break;case 8:r.prev=8,r.t0=r["catch"](3),n("responseStatus",500);case 11:case"end":return r.stop()}}),null,null,[[3,8]])}}};i["a"].use($["a"]);var Q=new $["a"].Store({state:{},mutations:{},actions:{},modules:{cities:F,weather:K}});i["a"].config.productionTip=!1,new i["a"]({store:Q,render:function(e){return e(L)}}).$mount("#weather")},"5e3b":function(e,t,n){},7029:function(e,t,n){},"85ec":function(e,t,n){},b455:function(e,t,n){"use strict";var i=n("52ea"),r=n.n(i);r.a}});
//# sourceMappingURL=app.ab78a091.js.map